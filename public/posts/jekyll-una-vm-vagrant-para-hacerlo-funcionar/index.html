<!DOCTYPE html>
<html lang="es-AR">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    
    <title>Jekyll: una VM Vagrant para hacerlo funcionar | katra</title>
    <meta name="viewport" content="width=device-width,minimum-scale=1">
    <meta name="description" content="Una VM es un buen lugar para tener una visualización previa de lo que publicaremos.">
    <meta name="generator" content="Hugo 0.143.0">
    
    
    
      <meta name="robots" content="index, follow">
    
    
      <meta name="author" content = "César Ballardini">
    

    
<link rel="stylesheet" href="/ananke/css/main.min.8ea42c4c5025337ca923faf1dc6e64b4dab13894d8f3f6908ee774c5b1502fec.css" >



    

    
      

    

    

    
      <link rel="canonical" href="https://katra.ballardini.com.ar/posts/jekyll-una-vm-vagrant-para-hacerlo-funcionar/">
    

    <meta property="og:url" content="https://katra.ballardini.com.ar/posts/jekyll-una-vm-vagrant-para-hacerlo-funcionar/">
  <meta property="og:site_name" content="katra">
  <meta property="og:title" content="Jekyll: una VM Vagrant para hacerlo funcionar">
  <meta property="og:description" content="Una VM es un buen lugar para tener una visualización previa de lo que publicaremos.">
  <meta property="og:locale" content="es_AR">
  <meta property="og:type" content="article">
    <meta property="article:section" content="posts">
    <meta property="article:published_time" content="2016-08-23T00:00:00-03:00">
    <meta property="article:modified_time" content="2016-08-23T00:00:00-03:00">
    <meta property="article:tag" content="Blog">
    <meta property="article:tag" content="Jekyll">
    <meta property="article:tag" content="Vagrant">
    <meta property="article:tag" content="Vagrantfile">
    <meta property="article:tag" content="Virtualbox">
    <meta property="article:tag" content="Ansible">

  <meta itemprop="name" content="Jekyll: una VM Vagrant para hacerlo funcionar">
  <meta itemprop="description" content="Una VM es un buen lugar para tener una visualización previa de lo que publicaremos.">
  <meta itemprop="datePublished" content="2016-08-23T00:00:00-03:00">
  <meta itemprop="dateModified" content="2016-08-23T00:00:00-03:00">
  <meta itemprop="wordCount" content="1241">
  <meta itemprop="keywords" content="Blog,Jekyll,Vagrant,Vagrantfile,Virtualbox,Ansible,Rvm,Ruby,Bundle">
  <meta name="twitter:card" content="summary">
  <meta name="twitter:title" content="Jekyll: una VM Vagrant para hacerlo funcionar">
  <meta name="twitter:description" content="Una VM es un buen lugar para tener una visualización previa de lo que publicaremos.">

      
    
	
  </head><body class="ma0 avenir bg-near-white production">

    
   
  

  <header>
    <div class="bg-black">
      <nav class="pv3 ph3 ph4-ns" role="navigation">
  <div class="flex-l justify-between items-center center">
    <a href="/" class="f3 fw2 hover-white no-underline white-90 dib">
      
        katra
      
    </a>
    <div class="flex-l items-center">
      

      
        <ul class="pl0 mr3">
          
          <li class="list f5 f4-ns fw4 dib pr3">
            <a class="hover-white no-underline white-90" href="/posts/" title="Entradas pagina">
              Entradas
            </a>
          </li>
          
        </ul>
      
      <div class="ananke-socials"><a href="http://linkedin.com/in/cesarballardini" target="_blank" rel="noopener"
        class="ananke-social-link link-transition linkedin link dib z-999 pt3 pt0-l mr1"
        title="follow on LinkedIn - Opens in a new window"
        aria-label="follow on LinkedIn - Opens in a new window">
      <span class="icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.6.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc. --><path d="M416 32H31.9C14.3 32 0 46.5 0 64.3v383.4C0 465.5 14.3 480 31.9 480H416c17.6 0 32-14.5 32-32.3V64.3c0-17.8-14.4-32.3-32-32.3zM135.4 416H69V202.2h66.5V416zm-33.2-243c-21.3 0-38.5-17.3-38.5-38.5S80.9 96 102.2 96c21.2 0 38.5 17.3 38.5 38.5 0 21.3-17.2 38.5-38.5 38.5zm282.1 243h-66.4V312c0-24.8-.5-56.7-34.5-56.7-34.6 0-39.9 27-39.9 54.9V416h-66.4V202.2h63.7v29.2h.9c8.9-16.8 30.6-34.5 62.9-34.5 67.2 0 79.7 44.3 79.7 101.9V416z"/></svg>
            
          </span></a><a href="https://x.com/cesarballardini" target="_blank" rel="noopener"
        class="ananke-social-link link-transition x-twitter link dib z-999 pt3 pt0-l mr1"
        title="follow on X - Opens in a new window"
        aria-label="follow on X - Opens in a new window">
      <span class="icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 6.6.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc. --><path d="M389.2 48h70.6L305.6 224.2 487 464H345L233.7 318.6 106.5 464H35.8L200.7 275.5 26.8 48H172.4L272.9 180.9 389.2 48zM364.4 421.8h39.1L151.1 88h-42L364.4 421.8z"/></svg>
            
          </span></a><a href="https://github.com/CesarBallardini/" target="_blank" rel="noopener"
        class="ananke-social-link link-transition github link dib z-999 pt3 pt0-l mr1"
        title="follow on GitHub - Opens in a new window"
        aria-label="follow on GitHub - Opens in a new window">
      <span class="icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><!--! Font Awesome Free 6.6.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc. --><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg>
            
          </span></a></div>

    </div>
  </div>
</nav>

    </div>
  </header>



    <main class="pb7" role="main">
      
  
  <article class="flex-l flex-wrap justify-between mw8 center ph3">
    <header class="mt4 w-100">
      <aside class="instapaper_ignoref b helvetica tracked ttu">
          
        Entradas
      </aside><div id="sharing" class="mt3 ananke-socials"><a href="mailto:?&amp;body=https%3A%2F%2Fkatra.ballardini.com.ar%2Fposts%2Fjekyll-una-vm-vagrant-para-hacerlo-funcionar%2F&amp;subject=Jekyll%3A&#43;una&#43;VM&#43;Vagrant&#43;para&#43;hacerlo&#43;funcionar"
        class="ananke-social-link email no-underline"
        title="Share on Email" aria-label="Share on Email"
        target="_blank" rel="nofollow noopener noreferrer">
        <span class="icon">
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 6.6.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc. --><path d="M64 112c-8.8 0-16 7.2-16 16l0 22.1L220.5 291.7c20.7 17 50.4 17 71.1 0L464 150.1l0-22.1c0-8.8-7.2-16-16-16L64 112zM48 212.2L48 384c0 8.8 7.2 16 16 16l384 0c8.8 0 16-7.2 16-16l0-171.8L322 328.8c-38.4 31.5-93.7 31.5-132 0L48 212.2zM0 128C0 92.7 28.7 64 64 64l384 0c35.3 0 64 28.7 64 64l0 256c0 35.3-28.7 64-64 64L64 448c-35.3 0-64-28.7-64-64L0 128z"/></svg>
                
              </span></a><a href="https://www.linkedin.com/shareArticle?&amp;mini=true&amp;source=https%3A%2F%2Fkatra.ballardini.com.ar%2Fposts%2Fjekyll-una-vm-vagrant-para-hacerlo-funcionar%2F&amp;summary=Vamos&#43;a&#43;usar&#43;Vagrant&#43;para&#43;instalar&#43;Jekyll&#43;3.x&#43;en&#43;una&#43;m%C3%A1quina&#43;virtual&#43;con&#43;Virtualbox%2C&#43;para&#43;editar&#43;y&#43;generar&#43;nuestro&#43;sitio%2C&#43;sin&#43;interferir&#43;con&#43;el&#43;sistema&#43;de&#43;escritorio&#43;que&#43;usemos&#43;para&#43;nuestro&#43;trabajo&#43;cotidiano.%0ASi&#43;no&#43;tienes&#43;instalado&#43;el&#43;combo&#43;vagrant&#43;%2B&#43;virtualbox%2C&#43;te&#43;recomiendo&#43;que&#43;lo&#43;hagas&#43;de&#43;acuerdo&#43;a&#43;las&#43;instrucciones&#43;en&#43;FIXME.%0AEl&#43;Vagrantfile&#43;nos&#43;permite&#43;crear&#43;una&#43;VM&#43;liviana&#43;con&#43;Ubuntu&#43;14.04&#43;Trusty&#43;de&#43;32&#43;bits%2C&#43;con&#43;poca&#43;memoria%2C&#43;m%C3%A1s&#43;que&#43;suficiente&#43;para&#43;nuestras&#43;necesidades.&#43;El&#43;aprovisionamiento&#43;se&#43;hace&#43;en&#43;dos&#43;etapas%3A&#43;1.&#43;los&#43;paquetes&#43;esenciales&#43;del&#43;sistema&#43;operativo%3B&#43;2.&#43;Ansible.%0A&amp;title=Jekyll%3A&#43;una&#43;VM&#43;Vagrant&#43;para&#43;hacerlo&#43;funcionar&amp;url=https%3A%2F%2Fkatra.ballardini.com.ar%2Fposts%2Fjekyll-una-vm-vagrant-para-hacerlo-funcionar%2F"
        class="ananke-social-link linkedin no-underline"
        title="Share on LinkedIn" aria-label="Share on LinkedIn"
        target="_blank" rel="nofollow noopener noreferrer">
        <span class="icon">
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.6.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc. --><path d="M416 32H31.9C14.3 32 0 46.5 0 64.3v383.4C0 465.5 14.3 480 31.9 480H416c17.6 0 32-14.5 32-32.3V64.3c0-17.8-14.4-32.3-32-32.3zM135.4 416H69V202.2h66.5V416zm-33.2-243c-21.3 0-38.5-17.3-38.5-38.5S80.9 96 102.2 96c21.2 0 38.5 17.3 38.5 38.5 0 21.3-17.2 38.5-38.5 38.5zm282.1 243h-66.4V312c0-24.8-.5-56.7-34.5-56.7-34.6 0-39.9 27-39.9 54.9V416h-66.4V202.2h63.7v29.2h.9c8.9-16.8 30.6-34.5 62.9-34.5 67.2 0 79.7 44.3 79.7 101.9V416z"/></svg>
                
              </span></a><a href="https://twitter.com/intent/tweet/?&amp;text=Vamos&#43;a&#43;usar&#43;Vagrant&#43;para&#43;instalar&#43;Jekyll&#43;3.x&#43;en&#43;una&#43;m%C3%A1quina&#43;virtual&#43;con&#43;Virtualbox%2C&#43;para&#43;editar&#43;y&#43;generar&#43;nuestro&#43;sitio%2C&#43;sin&#43;interferir&#43;con&#43;el&#43;sistema&#43;de&#43;escritorio&#43;que&#43;usemos&#43;para&#43;nuestro&#43;trabajo&#43;cotidiano.%0ASi&#43;no&#43;tienes&#43;instalado&#43;el&#43;combo&#43;vagrant&#43;%2B&#43;virtualbox%2C&#43;te&#43;recomiendo&#43;que&#43;lo&#43;hagas&#43;de&#43;acuerdo&#43;a&#43;las&#43;instrucciones&#43;en&#43;FIXME.%0AEl&#43;Vagrantfile&#43;nos&#43;permite&#43;crear&#43;una&#43;VM&#43;liviana&#43;con&#43;Ubuntu&#43;14.04&#43;Trusty&#43;de&#43;32&#43;bits%2C&#43;con&#43;poca&#43;memoria%2C&#43;m%C3%A1s&#43;que&#43;suficiente&#43;para&#43;nuestras&#43;necesidades.&#43;El&#43;aprovisionamiento&#43;se&#43;hace&#43;en&#43;dos&#43;etapas%3A&#43;1.&#43;los&#43;paquetes&#43;esenciales&#43;del&#43;sistema&#43;operativo%3B&#43;2.&#43;Ansible.%0A&amp;url=https%3A%2F%2Fkatra.ballardini.com.ar%2Fposts%2Fjekyll-una-vm-vagrant-para-hacerlo-funcionar%2F"
        class="ananke-social-link x-twitter no-underline"
        title="Share on X" aria-label="Share on X"
        target="_blank" rel="nofollow noopener noreferrer">
        <span class="icon">
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 6.6.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc. --><path d="M389.2 48h70.6L305.6 224.2 487 464H345L233.7 318.6 106.5 464H35.8L200.7 275.5 26.8 48H172.4L272.9 180.9 389.2 48zM364.4 421.8h39.1L151.1 88h-42L364.4 421.8z"/></svg>
                
              </span></a><a href="%25!s%28%3cnil%3e%29?"
        class="ananke-social-link github no-underline"
        title="Share on GitHub" aria-label="Share on GitHub"
        target="_blank" rel="nofollow noopener noreferrer">
        <span class="icon">
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><!--! Font Awesome Free 6.6.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc. --><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg>
                
              </span></a></div>
<h1 class="f1 athelas mt3 mb1">Jekyll: una VM Vagrant para hacerlo funcionar</h1>
      
      <p class="tracked">
        Por <strong>César Ballardini</strong>
      </p>
      
      
      
      <time class="f6 mv4 dib tracked" datetime="2016-08-23T00:00:00-03:00">23 de agosto de 2016</time>
      

      
      
        <span class="f6 mv4 dib tracked"> - Lectura en 6 minutos </span>
        <span class="f6 mv4 dib tracked"> - 1241 palabras </span>
      
    </header>
    <div class="nested-copy-line-height lh-copy serif f4 nested-links mid-gray pr4-l w-two-thirds-l"><p>Vamos a usar Vagrant para instalar Jekyll 3.x en una máquina virtual con Virtualbox, para editar y generar nuestro sitio, sin interferir con el sistema de escritorio que usemos para nuestro trabajo cotidiano.</p>
<p>Si no tienes instalado el combo vagrant + virtualbox, te recomiendo que lo hagas de acuerdo a las instrucciones en FIXME.</p>
<p>El <code>Vagrantfile</code> nos permite crear una VM liviana con Ubuntu 14.04 Trusty de 32 bits, con poca memoria, más que suficiente para nuestras necesidades.  El aprovisionamiento se hace en dos etapas: 1. los paquetes esenciales del sistema operativo; 2. Ansible.</p>
<p>El sistema operativo es todo lo necesario para que se puedan instalar paquetes, se aproveche un archivo de <em>swap</em> por si nos quedamos cortos con la RAM asignada, y la VM queda actualizada en sus paquetes.</p>
<p>Instalamos Ansible en la VM.  Esto es discutible.  Como pretendo que esta VM corra, se instale y se configure sin importar el software del equipo host, no puedo asegurar que Ansible funciona o siquiera es instalable en el host.  Lo instalamos en la VM y hacemos que sea su propia máquina de control Ansible. Cómo correr Ansible para que ejecute todas las instalaciones es algo que documentamos en <code>provision/ansible-setup.sh</code> que es un <em>oneliner</em>. Todas las rutas de los archivos serán relativas a la ubicación del <code>Vagrantfile</code>.</p>
<p>Luego hay que correr el playbook que instala las dependencias de Jekyll y el propio Jekyll.</p>
<p>Otro playbook se ocupa de hacer el deploy del sitio estático, y de subirlo a Github.</p>
<p>Vamos a ver cada una de estas cosas en detalle.</p>
<h2 id="vagrantfile"><code>Vagrantfile</code></h2>
<p>El <code>Vagrantfile</code> simplemente descarga un <em>box</em> estándar de Ubuntu, le asigna una dirección IP y tamaño de memoria adecuado a las necesidades.  Se crea un directorio <code>www/</code> en el host, que se mapea dentro de la VM para que sea el lugar donde se aloje el contenido del Web server.</p>
<p>También se invocan cuatro scripts para el aprovisionamiento:</p>
<ul>
<li><code>provision/os-setup.sh</code> instala lo esencial del sistema operativo para que funcione en la locación de instalación (<em>proxies</em>, fuentes de paquetes Debian, <em>swap</em>, <em>hostname</em>, etc.)</li>
<li><code>provision/ansible-setup.sh</code> (instala Ansible)</li>
<li><code>provision/ansible-playbook-install.sh</code> (instala roles y el playbook a usar)</li>
<li><code>provision/ansible-setup.sh</code> (corre Ansible para instalar Jekyll)</li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-ruby" data-lang="ruby"><span style="display:flex;"><span><span style="color:#66d9ef">VAGRANTFILE_API_VERSION</span> <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;2&#34;</span>
</span></span><span style="display:flex;"><span>arch<span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;i386&#34;</span> ; bits<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;32&#34;</span> ; distro<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;trusty&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">Vagrant</span><span style="color:#f92672">.</span>configure(<span style="color:#66d9ef">VAGRANTFILE_API_VERSION</span>) <span style="color:#66d9ef">do</span> <span style="color:#f92672">|</span>config<span style="color:#f92672">|</span>
</span></span><span style="display:flex;"><span>  config<span style="color:#f92672">.</span>vm<span style="color:#f92672">.</span>define <span style="color:#e6db74">&#34;github-pages&#34;</span><span style="color:#f92672">+</span>bits <span style="color:#66d9ef">do</span> <span style="color:#f92672">|</span>base<span style="color:#f92672">|</span>
</span></span><span style="display:flex;"><span>    base<span style="color:#f92672">.</span>vm<span style="color:#f92672">.</span>box <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;ubuntu/&#34;</span><span style="color:#f92672">+</span>distro<span style="color:#f92672">+</span>bits
</span></span><span style="display:flex;"><span>    base<span style="color:#f92672">.</span>vm<span style="color:#f92672">.</span>box_url <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;https://cloud-images.ubuntu.com/vagrant/trusty/current/&#34;</span><span style="color:#f92672">+</span>distro<span style="color:#f92672">+</span><span style="color:#e6db74">&#34;-server-cloudimg-&#34;</span><span style="color:#f92672">+</span>arch<span style="color:#f92672">+</span><span style="color:#e6db74">&#34;-vagrant-disk1.box&#34;</span>
</span></span><span style="display:flex;"><span>    base<span style="color:#f92672">.</span>vm<span style="color:#f92672">.</span>hostname <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;jk.dev&#34;</span>
</span></span><span style="display:flex;"><span>    base<span style="color:#f92672">.</span>vm<span style="color:#f92672">.</span>provision <span style="color:#e6db74">&#34;shell&#34;</span>, <span style="color:#e6db74">path</span>: <span style="color:#e6db74">&#34;provision/os-setup.sh&#34;</span>, <span style="color:#e6db74">privileged</span>: <span style="color:#66d9ef">true</span>
</span></span><span style="display:flex;"><span>    base<span style="color:#f92672">.</span>vm<span style="color:#f92672">.</span>provision <span style="color:#e6db74">&#34;shell&#34;</span>, <span style="color:#e6db74">path</span>: <span style="color:#e6db74">&#34;provision/ansible-setup.sh&#34;</span>, <span style="color:#e6db74">privileged</span>: <span style="color:#66d9ef">true</span>
</span></span><span style="display:flex;"><span>    base<span style="color:#f92672">.</span>vm<span style="color:#f92672">.</span>provision <span style="color:#e6db74">&#34;shell&#34;</span>, <span style="color:#e6db74">path</span>: <span style="color:#e6db74">&#34;provision/ansible-playbook-install.sh&#34;</span>, <span style="color:#e6db74">privileged</span>: <span style="color:#66d9ef">false</span>
</span></span><span style="display:flex;"><span>    base<span style="color:#f92672">.</span>vm<span style="color:#f92672">.</span>provision <span style="color:#e6db74">&#34;shell&#34;</span>, <span style="color:#e6db74">path</span>: <span style="color:#e6db74">&#34;provision/ansible-run.sh&#34;</span>, <span style="color:#e6db74">privileged</span>: <span style="color:#66d9ef">false</span>
</span></span><span style="display:flex;"><span>    base<span style="color:#f92672">.</span>vm<span style="color:#f92672">.</span>network <span style="color:#e6db74">&#34;forwarded_port&#34;</span>, <span style="color:#e6db74">guest</span>: <span style="color:#ae81ff">4000</span>, <span style="color:#e6db74">host</span>: <span style="color:#ae81ff">4000</span>
</span></span><span style="display:flex;"><span>    base<span style="color:#f92672">.</span>vm<span style="color:#f92672">.</span>network <span style="color:#e6db74">&#34;private_network&#34;</span>, <span style="color:#e6db74">ip</span>: <span style="color:#e6db74">&#34;192.168.33.10&#34;</span>
</span></span><span style="display:flex;"><span>    base<span style="color:#f92672">.</span>vm<span style="color:#f92672">.</span>synced_folder <span style="color:#e6db74">&#34;www/&#34;</span>, <span style="color:#e6db74">&#34;/srv/www&#34;</span>, <span style="color:#e6db74">create</span>: <span style="color:#66d9ef">true</span>
</span></span><span style="display:flex;"><span>    base<span style="color:#f92672">.</span>ssh<span style="color:#f92672">.</span>forward_agent <span style="color:#f92672">=</span> <span style="color:#66d9ef">true</span>
</span></span><span style="display:flex;"><span>    base<span style="color:#f92672">.</span>vm<span style="color:#f92672">.</span>provider <span style="color:#e6db74">&#34;virtualbox&#34;</span> <span style="color:#66d9ef">do</span> <span style="color:#f92672">|</span>vb<span style="color:#f92672">|</span>
</span></span><span style="display:flex;"><span>      vb<span style="color:#f92672">.</span>customize <span style="color:#f92672">[</span><span style="color:#e6db74">&#34;modifyvm&#34;</span>, <span style="color:#e6db74">:id</span>, <span style="color:#e6db74">&#34;--nictype1&#34;</span>, <span style="color:#e6db74">&#34;Am79C973&#34;</span><span style="color:#f92672">]</span>
</span></span><span style="display:flex;"><span>      vb<span style="color:#f92672">.</span>customize <span style="color:#f92672">[</span><span style="color:#e6db74">&#34;modifyvm&#34;</span>, <span style="color:#e6db74">:id</span>, <span style="color:#e6db74">&#34;--nictype2&#34;</span>, <span style="color:#e6db74">&#34;Am79C973&#34;</span><span style="color:#f92672">]</span>
</span></span><span style="display:flex;"><span>      vb<span style="color:#f92672">.</span>customize <span style="color:#f92672">[</span><span style="color:#e6db74">&#34;modifyvm&#34;</span>, <span style="color:#e6db74">:id</span>, <span style="color:#e6db74">&#34;--memory&#34;</span>, <span style="color:#ae81ff">512</span><span style="color:#f92672">]</span>
</span></span><span style="display:flex;"><span>      vb<span style="color:#f92672">.</span>customize <span style="color:#f92672">[</span><span style="color:#e6db74">&#34;modifyvm&#34;</span>, <span style="color:#e6db74">:id</span>, <span style="color:#e6db74">&#34;--natdnshostresolver1&#34;</span>, <span style="color:#e6db74">&#34;on&#34;</span><span style="color:#f92672">]</span>
</span></span><span style="display:flex;"><span>      vb<span style="color:#f92672">.</span>customize <span style="color:#f92672">[</span><span style="color:#e6db74">&#34;modifyvm&#34;</span>, <span style="color:#e6db74">:id</span>, <span style="color:#e6db74">&#34;--natdnsproxy1&#34;</span>, <span style="color:#e6db74">&#34;on&#34;</span><span style="color:#f92672">]</span>
</span></span><span style="display:flex;"><span>      vb<span style="color:#f92672">.</span>gui <span style="color:#f92672">=</span> <span style="color:#66d9ef">false</span>
</span></span><span style="display:flex;"><span>      vb<span style="color:#f92672">.</span>name <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;Jekyll Blog Vagrant &#34;</span><span style="color:#f92672">+</span>arch<span style="color:#f92672">+</span><span style="color:#e6db74">&#34; arch&#34;</span>
</span></span><span style="display:flex;"><span>      vb<span style="color:#f92672">.</span>memory <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;512&#34;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">end</span>
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">end</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">end</span>
</span></span></code></pre></div><h2 id="el-aprovisionamiento-del-sistema-operativo-básico">El aprovisionamiento del sistema operativo básico</h2>
<p>No hay mucho más que comentar en el código siguiente.  <em>Use the source, Luke!</em></p>
<p>Creamos un directorio <code>provision/</code> donde residirá todo el código de aprovisionamiento en shell, y un directorio <code>provision/ansible/</code> donde estarán roles, configuración y playbooks de Ansible.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>mkdir -p provision/ansible
</span></span></code></pre></div><p>El <code>provision/os-setup.sh</code> será el siguiente:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#75715e">#!/bin/bash
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#75715e">#</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">##</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># provision/os-setup.sh</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># instala lo necesario a nivel de sistema operativo</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">##</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Parámetros de la VM</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># vm_hostname: nombre de host dentro de la VM</span>
</span></span><span style="display:flex;"><span>vm_hostname<span style="color:#f92672">=</span>jk.dev
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># vm_swapfilesize: si esta vacío no se crea area de swap en la VM</span>
</span></span><span style="display:flex;"><span>vm_swapfilesize<span style="color:#f92672">=</span>2G
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">##</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># TODO: poner en configuración de la ubicación de trabajo</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Estos sources son para instalaciones con acceso a un mirror interno:</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># si se hace un noop, se usan los que vienen configurados en la VM desde el vagrant box usado</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#</span>
</span></span><span style="display:flex;"><span>aseguro_sources_list<span style="color:#f92672">()</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>  wget http://mirror.EXAMPLE.COM/listas/sources.list.14.04 -O /etc/apt/sources.list
</span></span><span style="display:flex;"><span>  :
</span></span><span style="display:flex;"><span><span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">############################################</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">##</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># no hay mas que modificar desde esta linea hacia abajo</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">##</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>distro<span style="color:#f92672">=</span><span style="color:#e6db74">`</span>lsb_release -d | awk <span style="color:#e6db74">&#39;{print $2}&#39;</span><span style="color:#e6db74">`</span>
</span></span><span style="display:flex;"><span>release<span style="color:#f92672">=</span><span style="color:#e6db74">`</span>lsb_release -d | awk <span style="color:#e6db74">&#39;{print $3}&#39;</span><span style="color:#e6db74">`</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>aseguro_config_apt<span style="color:#f92672">()</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>  aseguro_sources_list
</span></span><span style="display:flex;"><span>  apt-get    update
</span></span><span style="display:flex;"><span><span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>actualizo_paquetes_sistema<span style="color:#f92672">()</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>  apt-get    update
</span></span><span style="display:flex;"><span>  apt-get -y upgrade
</span></span><span style="display:flex;"><span>  apt-get -y autoremove
</span></span><span style="display:flex;"><span>  apt-get -y dist-upgrade
</span></span><span style="display:flex;"><span>  apt-get -y --force-yes autoremove
</span></span><span style="display:flex;"><span>  apt-get -y autoclean
</span></span><span style="display:flex;"><span><span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>aseguro_un_minimo_espacio_de_swap<span style="color:#f92672">()</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>  vm_swapfilesize<span style="color:#f92672">=</span>$1
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">if</span> <span style="color:#f92672">[</span> -n <span style="color:#e6db74">&#34;</span><span style="color:#e6db74">${</span>vm_swapfilesize<span style="color:#e6db74">}</span><span style="color:#e6db74">&#34;</span> <span style="color:#f92672">]</span>
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">then</span>
</span></span><span style="display:flex;"><span>    fallocate -l <span style="color:#e6db74">${</span>vm_swapfilesize<span style="color:#e6db74">}</span> /swapfile
</span></span><span style="display:flex;"><span>    chmod <span style="color:#ae81ff">600</span> /swapfile
</span></span><span style="display:flex;"><span>    mkswap /swapfile
</span></span><span style="display:flex;"><span>    swapon /swapfile
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># swapon -s  # verificar que el swap funciona</span>
</span></span><span style="display:flex;"><span>    echo <span style="color:#e6db74">&#39;/swapfile   none    swap    sw    0   0&#39;</span> &gt;&gt; /etc/fstab
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">fi</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>mejoras_en_performance<span style="color:#f92672">()</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>  sysctl vm.swappiness<span style="color:#f92672">=</span><span style="color:#ae81ff">10</span>
</span></span><span style="display:flex;"><span>  echo <span style="color:#e6db74">&#39;vm.swappiness=10&#39;</span> &gt; /etc/sysctl.conf
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  sysctl vm.vfs_cache_pressure<span style="color:#f92672">=</span><span style="color:#ae81ff">50</span>
</span></span><span style="display:flex;"><span>  echo <span style="color:#e6db74">&#39;vm.vfs_cache_pressure = 50&#39;</span> &gt; /etc/sysctl.conf
</span></span><span style="display:flex;"><span><span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>set_hostname<span style="color:#f92672">()</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>  echo <span style="color:#e6db74">&#39;127.0.0.1   &#39;</span>$1 &gt;&gt; /etc/hosts
</span></span><span style="display:flex;"><span><span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>instalo_keyring<span style="color:#f92672">()</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">[</span> $release <span style="color:#f92672">==</span> <span style="color:#e6db74">&#34;Debian&#34;</span> <span style="color:#f92672">]</span> <span style="color:#f92672">&amp;&amp;</span> apt-get install -y debian-keyring
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">[</span> $release <span style="color:#f92672">==</span> <span style="color:#e6db74">&#34;Ubuntu&#34;</span> <span style="color:#f92672">]</span> <span style="color:#f92672">&amp;&amp;</span> apt-get install -y --force-yes ubuntu-keyring ubuntu-extras-keyring
</span></span><span style="display:flex;"><span><span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>instalo_paquetes_esenciales<span style="color:#f92672">()</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>  apt-get install -y --force-yes debconf-utils
</span></span><span style="display:flex;"><span>  apt-get install -y --force-yes python-software-properties build-essential
</span></span><span style="display:flex;"><span>  apt-get install -y --force-yes git
</span></span><span style="display:flex;"><span><span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">###################################</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">##</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># main</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#</span>
</span></span><span style="display:flex;"><span>aseguro_config_apt
</span></span><span style="display:flex;"><span>aseguro_un_minimo_espacio_de_swap <span style="color:#e6db74">${</span>vm_swapfilesize<span style="color:#e6db74">}</span>
</span></span><span style="display:flex;"><span>mejoras_en_performance
</span></span><span style="display:flex;"><span>set_hostname <span style="color:#e6db74">${</span>vmhostname<span style="color:#e6db74">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>instalo_keyring
</span></span><span style="display:flex;"><span>instalo_paquetes_esenciales
</span></span><span style="display:flex;"><span>actualizo_paquetes_sistema
</span></span><span style="display:flex;"><span><span style="color:#75715e"># EOF</span>
</span></span></code></pre></div><h2 id="instalación-de-ansible">Instalación de Ansible</h2>
<p>Este <em>script</em> corre con privilegios de <em>root</em> y se ocupa de instalar la fuente de paquetes en Ubuntu (FIXME para otros S.O.) necesarios para instalar la versión estable más moderna de ansible.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#75715e">#!/bin/bash
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#75715e">#</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">##</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># provision/ansible-setup.sh</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># instala lo necesario para que funcione ansible</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>apt-get install -y python-software-properties build-essential
</span></span><span style="display:flex;"><span>apt-add-repository -y ppa:ansible/ansible
</span></span><span style="display:flex;"><span>apt-get update
</span></span><span style="display:flex;"><span>apt-get install ansible -y
</span></span></code></pre></div><h2 id="instalación-de-jekyll-y-sus-dependencias">Instalación de Jekyll y sus dependencias</h2>
<p>Vamos a usar playbooks de ansible para realizar la instalación de Jekyll y sus dependencias.</p>
<p>El primer paso es asegurar la configuración de ansible, la cual requiere un archivo de inventario, y uno de configuración global.</p>
<p>El inventario se denomina jk.inventory y su contenido es un grupo denominado jk, donde sólo reside la identificación de la VM (jk.dev) con una conexión local, para evitar el uso de SSH:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-ini" data-lang="ini"><span style="display:flex;"><span><span style="color:#66d9ef">[jk]</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">jk.dev  ansible_connection</span><span style="color:#f92672">=</span><span style="color:#e6db74">local</span>
</span></span></code></pre></div><p>El archivo de configuración de ansible se denomina <code>ansible.cfg</code>, y se instala localmente en el directorio de trabajo, para que se use en lugar del archivo global a nivel de sistema.  En nuestro caso está casi vacío de contenido y sólo tiene las líneas:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-ini" data-lang="ini"><span style="display:flex;"><span><span style="color:#66d9ef">[defaults]</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">roles_path</span>    <span style="color:#f92672">=</span> <span style="color:#e6db74">./roles</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">[privilege_escalation]</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">[paramiko_connection]</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">[ssh_connection]</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">[accelerate]</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">[selinux]</span>
</span></span></code></pre></div><p>Para ejecutar ansible usaremos el mandato <code>provision/ansible-run.sh</code>:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>cd /vagrant/provision/ansible
</span></span><span style="display:flex;"><span>time ansible-playbook -vv -i jk.inventory instala-jekyll.yml
</span></span></code></pre></div><h2 id="cómo-crear-el-playbook-de-instalación-de-jekyll">Cómo crear el playbook de instalación de Jekyll</h2>
<p>Primero debemos instalar los roles necesarios desde Ansible Galaxy:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>cd /vagrant/provision/ansible/roles/
</span></span><span style="display:flex;"><span>ansible-galaxy install rvm_io.rvm1-ruby
</span></span><span style="display:flex;"><span>ansible-galaxy install igor_mukhin.jekyll
</span></span></code></pre></div><p>Nuestro playbook de instalación será: <code>instala-jekyll.yml</code></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span>- <span style="color:#f92672">hosts</span>: <span style="color:#ae81ff">jk</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">vars</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">jekyll_version</span>: <span style="color:#ae81ff">3.2.1</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">roles</span>:
</span></span><span style="display:flex;"><span>    - {<span style="color:#f92672">role: rvm_io.rvm1-ruby, rvm1_gpg_key_server</span>: <span style="color:#e6db74">&#39;hkp://keyserver.ubuntu.com:80&#39;</span> }
</span></span><span style="display:flex;"><span>    - {<span style="color:#f92672">role: igor_mukhin.jekyll, tags: jekyll, become</span>: <span style="color:#66d9ef">true</span> }
</span></span></code></pre></div><p>Nota: Un problema de permisos en la creación de symlinks en roles/rvm_io.rvm1-ruby/tasks/rubies.yml se resuelve usando privilegios de administrador en el task, que debería quedar (cerca de la línea 54):</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span>- <span style="color:#f92672">name</span>: <span style="color:#ae81ff">Symlink ruby related binaries on the system path</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">file</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">state</span>: <span style="color:#e6db74">&#39;link&#39;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">src</span>: <span style="color:#e6db74">&#39;{{ rvm1_install_path }}/wrappers/default/{{ item }}&#39;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">dest</span>: <span style="color:#e6db74">&#39;{{ rvm1_symlink_to }}/{{ item }}&#39;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">owner</span>: <span style="color:#e6db74">&#39;root&#39;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">group</span>: <span style="color:#e6db74">&#39;root&#39;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">when</span>: <span style="color:#ae81ff">not &#39;--user-install&#39; in rvm1_install_flags</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">with_items</span>: <span style="color:#e6db74">&#39;{{ rvm1_symlink_binaries }}&#39;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">become</span>: <span style="color:#66d9ef">yes</span>
</span></span></code></pre></div><p>Todos estos pasos los englobaremos en un script bash para que corra al momento del aprovisionamiento, <code>provision/ansible-playbook-install.sh</code> es:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#75715e">#!/bin/bash
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#75715e">#</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">##</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># provision/ansible-playbook-install.sh</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># instala roles, playbooks y variables</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">##</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># playbook de instalación de software</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#</span>
</span></span><span style="display:flex;"><span>cat &gt; /vagrant/provision/ansible/instala-jekyll.yml &lt;&lt;!EOF
</span></span><span style="display:flex;"><span>- hosts: jk
</span></span><span style="display:flex;"><span>  vars:
</span></span><span style="display:flex;"><span>    jekyll_version: 3.2.1
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  roles:
</span></span><span style="display:flex;"><span>    - <span style="color:#f92672">{</span>role: rvm_io.rvm1-ruby, rvm1_gpg_key_server: <span style="color:#e6db74">&#39;hkp://keyserver.ubuntu.com:80&#39;</span> <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>    - <span style="color:#f92672">{</span>role: igor_mukhin.jekyll, tags: jekyll, become: true <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>!EOF
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">##</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># instalo roles</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>mkdir -p /vagrant/provision/ansible/roles/
</span></span><span style="display:flex;"><span>cd /vagrant/provision/ansible/
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>ansible-galaxy install rvm_io.rvm1-ruby
</span></span><span style="display:flex;"><span>ansible-galaxy install igor_mukhin.jekyll
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">##</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># emparcho rvm_io.rvm1-ruby, sino da problema de permisos al crear los symlinks</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span> -z <span style="color:#e6db74">&#34;</span><span style="color:#66d9ef">$(</span> sed -n -e <span style="color:#e6db74">&#34;63p&#34;</span>  /vagrant/provision/ansible/roles/rvm_io.rvm1-ruby/tasks/rubies.yml <span style="color:#66d9ef">)</span><span style="color:#e6db74">&#34;</span> <span style="color:#f92672">]</span> <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>  <span style="color:#f92672">&amp;&amp;</span> sed -i <span style="color:#e6db74">&#39;63i\ \ become: yes&#39;</span> /vagrant/provision/ansible/roles/rvm_io.rvm1-ruby/tasks/rubies.yml
</span></span></code></pre></div><ul class="pa0">
  
   <li class="list di">
     <a href="/tags/blog/" class="link f5 grow no-underline br-pill ba ph3 pv2 mb2 dib black sans-serif">Blog</a>
   </li>
  
   <li class="list di">
     <a href="/tags/jekyll/" class="link f5 grow no-underline br-pill ba ph3 pv2 mb2 dib black sans-serif">Jekyll</a>
   </li>
  
   <li class="list di">
     <a href="/tags/vagrant/" class="link f5 grow no-underline br-pill ba ph3 pv2 mb2 dib black sans-serif">Vagrant</a>
   </li>
  
   <li class="list di">
     <a href="/tags/vagrantfile/" class="link f5 grow no-underline br-pill ba ph3 pv2 mb2 dib black sans-serif">Vagrantfile</a>
   </li>
  
   <li class="list di">
     <a href="/tags/virtualbox/" class="link f5 grow no-underline br-pill ba ph3 pv2 mb2 dib black sans-serif">Virtualbox</a>
   </li>
  
   <li class="list di">
     <a href="/tags/ansible/" class="link f5 grow no-underline br-pill ba ph3 pv2 mb2 dib black sans-serif">Ansible</a>
   </li>
  
   <li class="list di">
     <a href="/tags/rvm/" class="link f5 grow no-underline br-pill ba ph3 pv2 mb2 dib black sans-serif">Rvm</a>
   </li>
  
   <li class="list di">
     <a href="/tags/ruby/" class="link f5 grow no-underline br-pill ba ph3 pv2 mb2 dib black sans-serif">Ruby</a>
   </li>
  
   <li class="list di">
     <a href="/tags/bundle/" class="link f5 grow no-underline br-pill ba ph3 pv2 mb2 dib black sans-serif">Bundle</a>
   </li>
  
</ul>
<div class="mt6 instapaper_ignoref">
      
      
      </div>
    </div>

    <aside class="w-30-l mt6-l">




  <div class="bg-light-gray pa3 nested-list-reset nested-copy-line-height nested-links">
    <p class="f5 b mb3">Relacionado</p>
    <ul class="pa0 list">
	   
	     <li  class="mb2">
          <a href="/posts/mi-nuevo-blog-con-jekyll/">Mi nuevo blog con Jekyll</a>
        </li>
	    
    </ul>
</div>

</aside>

  </article>

    </main>
    <footer class="bg-black bottom-0 w-100 pa3" role="contentinfo">
  <div class="flex justify-between">
  <a class="f4 fw4 hover-white no-underline white-70 dn dib-ns pv2 ph3" href="https://katra.ballardini.com.ar/" >
    &copy;  César Ballardini 2025 
  </a>
    <div><div class="ananke-socials"><a href="http://linkedin.com/in/cesarballardini" target="_blank" rel="noopener"
        class="ananke-social-link link-transition linkedin link dib z-999 pt3 pt0-l mr1"
        title="follow on LinkedIn - Opens in a new window"
        aria-label="follow on LinkedIn - Opens in a new window">
      <span class="icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.6.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc. --><path d="M416 32H31.9C14.3 32 0 46.5 0 64.3v383.4C0 465.5 14.3 480 31.9 480H416c17.6 0 32-14.5 32-32.3V64.3c0-17.8-14.4-32.3-32-32.3zM135.4 416H69V202.2h66.5V416zm-33.2-243c-21.3 0-38.5-17.3-38.5-38.5S80.9 96 102.2 96c21.2 0 38.5 17.3 38.5 38.5 0 21.3-17.2 38.5-38.5 38.5zm282.1 243h-66.4V312c0-24.8-.5-56.7-34.5-56.7-34.6 0-39.9 27-39.9 54.9V416h-66.4V202.2h63.7v29.2h.9c8.9-16.8 30.6-34.5 62.9-34.5 67.2 0 79.7 44.3 79.7 101.9V416z"/></svg>
            
          </span></a><a href="https://x.com/cesarballardini" target="_blank" rel="noopener"
        class="ananke-social-link link-transition x-twitter link dib z-999 pt3 pt0-l mr1"
        title="follow on X - Opens in a new window"
        aria-label="follow on X - Opens in a new window">
      <span class="icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 6.6.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc. --><path d="M389.2 48h70.6L305.6 224.2 487 464H345L233.7 318.6 106.5 464H35.8L200.7 275.5 26.8 48H172.4L272.9 180.9 389.2 48zM364.4 421.8h39.1L151.1 88h-42L364.4 421.8z"/></svg>
            
          </span></a><a href="https://github.com/CesarBallardini/" target="_blank" rel="noopener"
        class="ananke-social-link link-transition github link dib z-999 pt3 pt0-l mr1"
        title="follow on GitHub - Opens in a new window"
        aria-label="follow on GitHub - Opens in a new window">
      <span class="icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><!--! Font Awesome Free 6.6.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc. --><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg>
            
          </span></a></div>
</div>
  </div>
</footer>

  </body>
</html>
